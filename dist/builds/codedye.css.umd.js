!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).CodeDye={})}(this,(function(e){"use strict";const t=new Map,n=new Map;function s(e){for(const t of e.classList)if(t.startsWith("language-"))return t.slice(9);return"js"}function o(e="js"){if(t.has(e))return t.get(e);const s=n.get(e);if("function"!=typeof s)throw new Error(`Language "${e}" not registered`);const o=s();return t.set(e,o),o}const r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},a=/[&<>"']/g;function i(e=""){return e.replace(a,(e=>r[e]))}class c{constructor(e){this.rules=e,this.stateStack=[],this.bracketDepth=0,this._regexCache=new Map,this._compileAllRules(),this.setState("root")}setState(e){this.currentState=e}pushState(e){this.stateStack.push(this.currentState),this.setState(e)}popState(){return this.stateStack.length&&this.setState(this.stateStack.pop()),this.currentState}_compileAllRules(){this._compiled={};const e=this.rules.tokenizer||{};for(const[t,n]of Object.entries(e))this._compiled[t]=n.map((e=>{if(e.include)return{include:e.include.replace(/^@/,"")};const[t,n,s]=e;return{re:this._expandRegex(t,!0),outSpec:n,nextHint:s}}))}_expandRegex(e,t=!1){const n=e.toString()+(t?"y":"");if(this._regexCache.has(n))return this._regexCache.get(n);let s;if("string"==typeof e)s=new RegExp("^"+e,t?"y":"");else{let n=e.flags||"";t&&!n.includes("y")&&(n+="y");const o=e.source.replace(/@(\w+)/g,((e,t)=>{const n=this.rules[t];return n instanceof RegExp?n.source:"string"==typeof n?n:""}));s=new RegExp(o,n)}return this._regexCache.set(n,s),s}tokenize(e){const t=[];let n=0;for(;n<e.length;){const{pos:s,matches:o}=this._processState(this.currentState,e,n);o.length?(t.push(...o),n=s):(t.push({text:e[n],token:this.rules.defaultToken}),n++)}return t}_stripPost(e){const t=this.rules.tokenPostfix;return"string"==typeof e&&t&&e.endsWith(t)?e.slice(0,-t.length):e}_makeTok(e,t,n,s){const o={text:e,token:this._stripPost(t)};return n&&(o.embedEnter=n),s&&(o.embedExit=!0),o}_processState(e,t,n){const s=this._compiled[e];if(!s)return{pos:n,matches:[]};for(const e of s){if(e.include){const s=this._processState(e.include,t,n);if(s.matches.length||s.rematch)return s;continue}const{re:s,outSpec:o,nextHint:r}=e;s.lastIndex=n;const a=s.exec(t);if(!a)continue;if(Array.isArray(o)){const e=a[0],t=a.slice(1).map(((e,t)=>{const n=o[t];let s=this.rules.defaultToken,r=null,a=null;return"string"==typeof n?s=n:n&&"object"==typeof n&&(s=n.token||s,n.next&&this._handleNext(n.next),r=n.embedEnter||null,a=!!n.embedExit),this._makeTok(e,s,r,a)}));return{pos:n+e.length,matches:t}}let i=this.rules.defaultToken,c=r,l=null,u=null;if("string"==typeof o)i=o;else if(o&&"object"==typeof o){if(o.token&&(i=o.token),o.cases){let e=o.cases["@default"];for(const[t,n]of Object.entries(o.cases)){const s=this.rules[t.slice(1)];if(t.startsWith("@")&&Array.isArray(s)&&s.includes(a[0])||t===a[0]){e=n;break}}"string"==typeof e?i=e:e&&"object"==typeof e&&(i=e.token||i,e.next&&(c=e.next))}o.next&&(c=o.next),l=o.embedEnter||null,u=!!o.embedExit}if("string"==typeof c&&this._handleNext(c),"delimiter.bracket"===i){let e;/^[\{\(\[]$/.test(a[0])?(e=this.bracketDepth%6+1,this.bracketDepth++):(this.bracketDepth=Math.max(0,this.bracketDepth-1),e=this.bracketDepth%6+1),i+=`.level${e}`}return"@rematch"===i?{pos:n,matches:[{text:"",token:this.rules.defaultToken,embedExit:!0}]}:{pos:n+a[0].length,matches:[this._makeTok(a[0],i,l,u)]}}return{pos:n,matches:[]}}_handleNext(e){"@pop"===e?this.popState():e.startsWith("@")?this.pushState(e.slice(1)):this.pushState(e)}}class l{constructor(e){this.langStack=[{lang:e,tk:new c(o(e))}]}_cur(){return this.langStack[this.langStack.length-1]}tokenizeLine(e){const t=[],n=this.langStack;if(n.length>1&&"md"===n[0].lang&&/^\s*(```|~~~)/.test(e)){this.langStack.length=1;return this.langStack[0].tk.popState(),[{text:e,token:"string",lang:"md"}]}if(n.length>1){const{lang:s,tk:o}=this._cur(),r="css"===s?"</style>":"js"===s?"<\/script>":null;if(r&&e.includes(r)){const a=e.indexOf(r);a>0&&o.tokenize(e.slice(0,a)).forEach((e=>t.push({...e,lang:s}))),n.pop();const i=this._cur();return i.tk.tokenize(e.slice(a)).forEach((e=>t.push({...e,lang:i.lang}))),t}}for(const s of this._cur().tk.tokenize(e))if(s.embedEnter){t.push({...s,lang:this._cur().lang});const e=new c(o(s.embedEnter));e.setState("root"),n.push({lang:s.embedEnter,tk:e})}else if(s.embedExit){n.length>1&&n.pop();const e=this._cur().tk;e.setState("root"),e.stateStack=[],e.bracketDepth=0}else t.push({...s,lang:this._cur().lang});return t}setState(e){this._cur().tk.setState(e)}get stateStack(){return this._cur().tk.stateStack}set stateStack(e){this._cur().tk.stateStack=e}get bracketDepth(){return this._cur().tk.bracketDepth}set bracketDepth(e){this._cur().tk.bracketDepth=e}}const u={javascript:"js",typescript:"ts",html:"html",css:"css",python:"py",csharp:"cs",markdown:"md"};class g{constructor(){this.language="txt",this.stateStack=[],this.bracketDepth=0}tokenizeLine(e){return[{text:e,token:null,lang:"txt"}]}setState(e){}}const h={_resetTokenizer(e){e.setState("root"),e.stateStack.length=0,e.bracketDepth=0},init(e,t,n={}){"object"==typeof e&&({source:e,target:t,...n}=e);const s="string"==typeof e?document.querySelector(e):e,o="string"==typeof t?document.querySelector(t):t;if(!s||!o)throw new Error("Invalid source / target");const r={language:"js",debounce:0,...n};let a;r.language=u[r.language]||r.language;try{a=new l(r.language)}catch(e){console.warn(`Language "${r.language}" not registered, falling back to plain text.`),a=new g,r.language="txt"}const c=()=>{this._resetTokenizer(a);const e=s.value.split("\n");let t="";for(const n of e){for(const e of a.tokenizeLine(n))t+=e.token?`<span class="${e.token} ${e.lang}-${e.token}">${i(e.text)}</span>`:i(e.text);t+="\n"}o.innerHTML=`<code class="language-${r.language}">${t}</code>`},h=r.debounce?function(e,t=0){let n;return(...s)=>{clearTimeout(n),n=setTimeout((()=>e(...s)),t)}}(c,r.debounce):c;s.addEventListener("input",h),c()},highlightElement(e="",t={}){const n={language:"js",...t};let s;n.language=u[n.language]||n.language;try{s=new l(n.language)}catch(e){console.warn(`Language "${n.language}" not registered, falling back to plain text.`),s=new g,n.language="txt"}this._resetTokenizer(s);const o=e.split("\n");let r="";for(const e of o){for(const t of s.tokenizeLine(e))r+=t.token?`<span class="${t.token} ${t.lang}-${t.token}">${i(t.text)}</span>`:i(t.text);r+="\n"}return`<code class="language-${n.language}">${r}</code>`},highlightBlock(e,t={}){"string"==typeof e&&(e=document.querySelector(e));const n={language:s(e),...t};let o;n.language=u[n.language]||n.language;try{o=new l(n.language)}catch(e){console.warn(`Language "${n.language}" not registered, falling back to plain text.`),o=new g,n.language="txt"}this._resetTokenizer(o);const r=e.textContent.split("\n");let a="";for(const e of r){for(const t of o.tokenizeLine(e))a+=t.token?`<span class="${t.token} ${t.lang}-${t.token}">${i(t.text)}</span>`:i(t.text);a+="\n"}e.innerHTML=a},highlight(){document.querySelectorAll('pre code[class*="language-"],code[class*="language-"]').forEach((e=>{try{this.highlightBlock(e)}catch(e){console.warn(e)}}))}};function p(){return{defaultToken:"",tokenPostfix:".css",keywords:["@charset","@import","@namespace","@media","@supports","@document","@font-face","@page","@counter-style","@font-feature-values","@keyframes","@-webkit-keyframes","@-moz-keyframes","@-o-keyframes"],pseudoClasses:["active","any","checked","default","disabled","empty","enabled","first","first-child","first-of-type","fullscreen","focus","hover","indeterminate","in-range","invalid","last-child","last-of-type","link","only-child","only-of-type","optional","out-of-range","read-only","read-write","required","root","target","valid","visited"],pseudoElements:["after","before","first-letter","first-line","selection","backdrop","placeholder"],tokenizer:{root:[[/[ \t\r\n]+/,""],[/\/\*/,"comment","@comment"],[/@[a-zA-Z\-]+/,{cases:{"@keywords":"keyword.at-rule","@default":"keyword"}}],[/::?[A-Za-z][\w-]*/,{cases:{"@pseudoClasses":"keyword.pseudo-class","@pseudoElements":"keyword.pseudo-element","@default":"attribute.name"}}],[/[^@{};,][^@{};]*,/,{token:"selector",next:"@selectors"}],[/[^@{};]+(?=\{)/,{token:"selector",next:"@selectors"}],[/\{/,{token:"delimiter.bracket",next:"@block"}]],selectors:[[/[ \t\r\n]+/,""],[/\/\*/,"comment","@comment"],[/\,/,"delimiter"],[/::?[A-Za-z][\w-]*/,"keyword"],[/[.#]?[A-Za-z_][\w-]*/,"selector"],[/\{/,{token:"delimiter.bracket",next:"@block"}]],block:[[/[ \t\r\n]+/,""],[/\/\*/,"comment","@comment"],[/\}/,{token:"delimiter.bracket",next:"@pop"}],[/(\d+%|from|to)/,"constant.numeric"],[/[A-Za-z_-][\w-]*(?=\s*:)/,"attribute.name"],[/:\s*/,"delimiter"],{include:"@value"},[/;/,"delimiter"],[/\{/,{token:"delimiter.bracket",next:"@block"}]],keyframesBlock:[[/[ \t\r\n]+/,""],[/\/\*/,"comment","@comment"],[/\{/,{token:"delimiter.bracket",next:"@block"}]],value:[[/[ \t\r\n]+/,""],[/-?\d*\.?\d+(?:em|rem|px|vw|vh|%|s|ms)?/,"number"],[/#([0-9A-Fa-f]{3,8})/,"number.hex"],[/"/,"string","@string_double"],[/'/,"string","@string_single"],[/([A-Za-z_-][\w-]*)(\()/,["function",{token:"delimiter.parenthesis",next:"@func"}]],[/!important\b/,"keyword"],[/[A-Za-z_-][\w-]*/,"identifier"]],func:[{include:"@value"},[/\)/,"delimiter.parenthesis","@pop"]],comment:[[/[^*]+/,"comment"],[/\*\//,"comment","@pop"],[/./,"comment"]],string_double:[[/[^\\"]+/,"string"],[/\\./,"string.escape"],[/"/,"string","@pop"]],string_single:[[/[^\\']+/,"string"],[/\\./,"string.escape"],[/'/,"string","@pop"]]}}}var d,k;window.addEventListener("DOMContentLoaded",(()=>h.highlight())),d="css",k=p,n.set(d,k),"undefined"==typeof window||window.CodeDye||(window.CodeDye=h),e.getCssRules=p,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=codedye.css.umd.js.map
