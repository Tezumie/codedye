!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).CodeDye={})}(this,(function(t){"use strict";const e=new Map,n=new Map;function s(t){for(const e of t.classList)if(e.startsWith("language-"))return e.slice(9);return"js"}function o(t="js"){if(e.has(t))return e.get(t);const s=n.get(t);if("function"!=typeof s)throw new Error(`Language "${t}" not registered`);const o=s();return e.set(t,o),o}const a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},r=/[&<>"']/g;function i(t=""){return t.replace(r,(t=>a[t]))}class c{constructor(t){this.rules=t,this.stateStack=[],this.bracketDepth=0,this._regexCache=new Map,this._compileAllRules(),this.setState("root")}setState(t){this.currentState=t}pushState(t){this.stateStack.push(this.currentState),this.setState(t)}popState(){return this.stateStack.length&&this.setState(this.stateStack.pop()),this.currentState}_compileAllRules(){this._compiled={};const t=this.rules.tokenizer||{};for(const[e,n]of Object.entries(t))this._compiled[e]=n.map((t=>{if(t.include)return{include:t.include.replace(/^@/,"")};const[e,n,s]=t;return{re:this._expandRegex(e,!0),outSpec:n,nextHint:s}}))}_expandRegex(t,e=!1){const n=t.toString()+(e?"y":"");if(this._regexCache.has(n))return this._regexCache.get(n);let s;if("string"==typeof t)s=new RegExp("^"+t,e?"y":"");else{let n=t.flags||"";e&&!n.includes("y")&&(n+="y");const o=t.source.replace(/@(\w+)/g,((t,e)=>{const n=this.rules[e];return n instanceof RegExp?n.source:"string"==typeof n?n:""}));s=new RegExp(o,n)}return this._regexCache.set(n,s),s}tokenize(t){const e=[];let n=0;for(;n<t.length;){const{pos:s,matches:o}=this._processState(this.currentState,t,n);o.length?(e.push(...o),n=s):(e.push({text:t[n],token:this.rules.defaultToken}),n++)}return e}_stripPost(t){const e=this.rules.tokenPostfix;return"string"==typeof t&&e&&t.endsWith(e)?t.slice(0,-e.length):t}_makeTok(t,e,n,s){const o={text:t,token:this._stripPost(e)};return n&&(o.embedEnter=n),s&&(o.embedExit=!0),o}_processState(t,e,n){const s=this._compiled[t];if(!s)return{pos:n,matches:[]};for(const t of s){if(t.include){const s=this._processState(t.include,e,n);if(s.matches.length||s.rematch)return s;continue}const{re:s,outSpec:o,nextHint:a}=t;s.lastIndex=n;const r=s.exec(e);if(!r)continue;if(Array.isArray(o)){const t=r[0],e=r.slice(1).map(((t,e)=>{const n=o[e];let s=this.rules.defaultToken,a=null,r=null;return"string"==typeof n?s=n:n&&"object"==typeof n&&(s=n.token||s,n.next&&this._handleNext(n.next),a=n.embedEnter||null,r=!!n.embedExit),this._makeTok(t,s,a,r)}));return{pos:n+t.length,matches:e}}let i=this.rules.defaultToken,c=a,l=null,u=null;if("string"==typeof o)i=o;else if(o&&"object"==typeof o){if(o.token&&(i=o.token),o.cases){let t=o.cases["@default"];for(const[e,n]of Object.entries(o.cases)){const s=this.rules[e.slice(1)];if(e.startsWith("@")&&Array.isArray(s)&&s.includes(r[0])||e===r[0]){t=n;break}}"string"==typeof t?i=t:t&&"object"==typeof t&&(i=t.token||i,t.next&&(c=t.next))}o.next&&(c=o.next),l=o.embedEnter||null,u=!!o.embedExit}if("string"==typeof c&&this._handleNext(c),"delimiter.bracket"===i){let t;/^[\{\(\[]$/.test(r[0])?(t=this.bracketDepth%6+1,this.bracketDepth++):(this.bracketDepth=Math.max(0,this.bracketDepth-1),t=this.bracketDepth%6+1),i+=`.level${t}`}return"@rematch"===i?{pos:n,matches:[{text:"",token:this.rules.defaultToken,embedExit:!0}]}:{pos:n+r[0].length,matches:[this._makeTok(r[0],i,l,u)]}}return{pos:n,matches:[]}}_handleNext(t){"@pop"===t?this.popState():t.startsWith("@")?this.pushState(t.slice(1)):this.pushState(t)}}class l{constructor(t){this.langStack=[{lang:t,tk:new c(o(t))}]}_cur(){return this.langStack[this.langStack.length-1]}tokenizeLine(t){const e=[],n=this.langStack;if(n.length>1&&"md"===n[0].lang&&/^\s*(```|~~~)/.test(t)){this.langStack.length=1;return this.langStack[0].tk.popState(),[{text:t,token:"string",lang:"md"}]}if(n.length>1){const{lang:s,tk:o}=this._cur(),a="css"===s?"</style>":"js"===s?"<\/script>":null;if(a&&t.includes(a)){const r=t.indexOf(a);r>0&&o.tokenize(t.slice(0,r)).forEach((t=>e.push({...t,lang:s}))),n.pop();const i=this._cur();return i.tk.tokenize(t.slice(r)).forEach((t=>e.push({...t,lang:i.lang}))),e}}for(const s of this._cur().tk.tokenize(t))if(s.embedEnter){e.push({...s,lang:this._cur().lang});const t=new c(o(s.embedEnter));t.setState("root"),n.push({lang:s.embedEnter,tk:t})}else if(s.embedExit){n.length>1&&n.pop();const t=this._cur().tk;t.setState("root"),t.stateStack=[],t.bracketDepth=0}else e.push({...s,lang:this._cur().lang});return e}setState(t){this._cur().tk.setState(t)}get stateStack(){return this._cur().tk.stateStack}set stateStack(t){this._cur().tk.stateStack=t}get bracketDepth(){return this._cur().tk.bracketDepth}set bracketDepth(t){this._cur().tk.bracketDepth=t}}const u={javascript:"js",typescript:"ts",html:"html",css:"css",python:"py",csharp:"cs",markdown:"md"};class h{constructor(){this.language="txt",this.stateStack=[],this.bracketDepth=0}tokenizeLine(t){return[{text:t,token:null,lang:"txt"}]}setState(t){}}const g={_resetTokenizer(t){t.setState("root"),t.stateStack.length=0,t.bracketDepth=0},init(t,e,n={}){"object"==typeof t&&({source:t,target:e,...n}=t);const s="string"==typeof t?document.querySelector(t):t,o="string"==typeof e?document.querySelector(e):e;if(!s||!o)throw new Error("Invalid source / target");const a={language:"js",debounce:0,...n};let r;a.language=u[a.language]||a.language;try{r=new l(a.language)}catch(t){console.warn(`Language "${a.language}" not registered, falling back to plain text.`),r=new h,a.language="txt"}const c=()=>{this._resetTokenizer(r);const t=s.value.split("\n");let e="";for(const n of t){for(const t of r.tokenizeLine(n))e+=t.token?`<span class="${t.token} ${t.lang}-${t.token}">${i(t.text)}</span>`:i(t.text);e+="\n"}o.innerHTML=`<code class="language-${a.language}">${e}</code>`},g=a.debounce?function(t,e=0){let n;return(...s)=>{clearTimeout(n),n=setTimeout((()=>t(...s)),e)}}(c,a.debounce):c;s.addEventListener("input",g),c()},highlightElement(t="",e={}){const n={language:"js",...e};let s;n.language=u[n.language]||n.language;try{s=new l(n.language)}catch(t){console.warn(`Language "${n.language}" not registered, falling back to plain text.`),s=new h,n.language="txt"}this._resetTokenizer(s);const o=t.split("\n");let a="";for(const t of o){for(const e of s.tokenizeLine(t))a+=e.token?`<span class="${e.token} ${e.lang}-${e.token}">${i(e.text)}</span>`:i(e.text);a+="\n"}return`<code class="language-${n.language}">${a}</code>`},highlightBlock(t,e={}){"string"==typeof t&&(t=document.querySelector(t));const n={language:s(t),...e};let o;n.language=u[n.language]||n.language;try{o=new l(n.language)}catch(t){console.warn(`Language "${n.language}" not registered, falling back to plain text.`),o=new h,n.language="txt"}this._resetTokenizer(o);const a=t.textContent.split("\n");let r="";for(const t of a){for(const e of o.tokenizeLine(t))r+=e.token?`<span class="${e.token} ${e.lang}-${e.token}">${i(e.text)}</span>`:i(e.text);r+="\n"}t.innerHTML=r},highlight(){document.querySelectorAll('pre code[class*="language-"],code[class*="language-"]').forEach((t=>{try{this.highlightBlock(t)}catch(t){console.warn(t)}}))}};function p(){return{defaultToken:"",tokenPostfix:".json",keywords:["true","false","null"],symbols:/[{}\[\]:,]/,escapes:/\\(?:["\\/bfnrt]|u[0-9A-Fa-f]{4})/,digits:/\d+(_+\d+)*/,hexdigits:/[0-9A-Fa-f]+(_+[0-9A-Fa-f]+)*/,tokenizer:{root:[[/{|}/,"delimiter.bracket"],[/\[|\]/,"delimiter.bracket"],[/[:,]/,"delimiter"],[/\"([^\"\\]|\\.)*\"(?=\s*:)/,"string.key"],[/\"([^\"\\]|\\.)*\"/,"string.value"],[/0[xX]@hexdigits/,"number.hex"],[/-?@digits\.\d+([eE][+\-]?\d+)?/,"number.float"],[/-?@digits([eE][+\-]?\d+)?/,"number"],[/\b(?:true|false|null)\b/,"keyword.constant"],{include:"@whitespace"}],whitespace:[[/[ \t\r\n]+/,""],[/\/\/.*$/,"comment"],[/\/\*/,"comment","@comment"]],comment:[[/[^\/*]+/,"comment"],[/\*\//,"comment","@pop"],[/[\/*]/,"comment"]]}}}var f,d;window.addEventListener("DOMContentLoaded",(()=>g.highlight())),f="json",d=p,n.set(f,d),"undefined"==typeof window||window.CodeDye||(window.CodeDye=g),t.getJsonRules=p,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=codedye.json.umd.js.map
